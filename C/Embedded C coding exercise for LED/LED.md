# Harware connections

- Lets understand how external hardware (LED) is connected to MCU
- In STM32Fx based MCUs, each port has 16 pins where you can connect external peripherals.
  (LED, Display, button, Bluetooth transceiver, external memory (e.g. EEPROM), Joy stick, keypad, etc)

<img src="https://user-images.githubusercontent.com/61633137/102006009-b2273200-3d60-11eb-99bf-32b5b3dea092.png" alt="Screenshot from 2020-12-13 14-30-26" style="zoom: 67%;" />

<img src="https://user-images.githubusercontent.com/61633137/102006014-beab8a80-3d60-11eb-86b1-00097e038c13.png" alt="Screenshot from 2020-12-13 14-29-53" style="zoom: 80%;" />

![Screenshot from 2020-12-13 14-32-20](https://user-images.githubusercontent.com/61633137/102006022-cff49700-3d60-11eb-8013-4ab2a88fc68e.png)

# About peripheral registers

- All peripheral registers in STM32 microcontroller are of 32 bits wide
- Different perpherals have different number of peripheral registers.
- You should never assume about the address of the peripheral registers. Always you should refer to the device reference manual.

## GPIOD Peripheral registers

- GPIOD port mode register
- GPIOD port output type register
- GPIOD port output speed register
- GPIOD port pull-up/pull-down register
- GPIOD port input data register
- GPIOD port output data register
- GPIOD port bit set/reset register
- GPIOD port configuration lock register
- GPIOD alternate function low register
- GPIOD alternate function high register

# Procedure to turn on the LED

1. Identify the GPIO port(a peripheral) used to connect the LED
   __GPIOD__
2. Identify the GPIO pin where the LED is connected
   __12__
3. Activate the GPIOD peripheral (Enable the clock)
   - Until  you enable the clock for a peripheral, the peripheral is dead and it neither functions nor it takes any configuation value set by you
   - Once you active the clock for a peripheral, the pripheral is ready to take your configuation and control-related commands or arguments (configuration values)
   - For some microcontrollers, the pripheral may be ON by default, an

4. d you need not do any activation. 
    (you should explore by the device datasheet for reference manual)Configure the GPIO pin mode as output
    Since you are driving and LED (to ON or OFF), the operation mode of the GPIO pin has to be configured as OUTPUT

5. Write to the GPIO pin
   1 (HIGH) to make the GPIO pin state HIGH(3.3V)
   0 (LOW) to make the GPIO pin state LOW(0V)

- Address Information

  Address of the Clock control register
  0x40023800 + 0x30(offset) ==> 0x40023830

  Address of the GPIOB mode register (used to control mode)
  0x40020400 + 0x00(offset) == > 0x40020400

  Address of the GPIOB ouput data register (used to write)
  0x40020400 + 0x04(offset) == > 0x40020404

```c
/**
  ******************************************************************************
  * @file    main.c
  * @author  Auto-generated by STM32CubeIDE
  * @version V1.0
  * @brief   Default main function.
  ******************************************************************************
*/

#include<stdint.h>

int main(void)
{
	uint32_t *pClkCtrlReg =   (uint32_t*)0x40023830;
	uint32_t *pPortDModeReg = (uint32_t*)0x40020C00;
	uint32_t *pPortDOutReg =  (uint32_t*)0x40020C14;

	//1. enable the clock for GPOID peripheral in the AHB1ENR (SET the 3rd bit position)
	*pClkCtrlReg |= ( 1 << 3);

	//2. configure the mode of the IO pin as output
	//a. clear the 24th and 25th bit positions (CLEAR)
	*pPortDModeReg &= ~( 3 << 24);
	//b. make 24th bit position as 1 (SET)
	*pPortDModeReg |= ( 1 << 24);

	//3.SET 12th bit of the output data register to make I/O pin-12 as HIGH
	*pPortDOutReg |= ( 1 << 12);

    while(1);
}
```

